!function(){var n=window.nLingual={},e=n.Framework={},t=e.Language=Backbone.Model.extend({defaults:{system_name:"",native_name:"",short_name:"",iso_code:"",slug:"",locale_name:"",direction:"",active:!0}}),a=e.LanguageSet=Backbone.Collection.extend({model:t}),l=e.LocalizableField=Backbone.Model.extend({idAttribute:"field",defaults:{field_id:"",values:"",nonce:""}}),i=e.LocalizableFieldSet=Backbone.Collection.extend({model:l}),o=e.Translation=Backbone.Model.extend({defaults:{title:"",date:"",is_assigned:!1}}),s=e.TranslationSet=Backbone.Collection.extend({model:o,sortBy:function(n,e){e=!0===e||"desc"===e,this.models=this.models.sort(function(t,a){var l=t.get(n),i=a.get(n);return l>i?e?-1:1:l<i?e?1:-1:0}),this.trigger("sort",this)}}),r=e.TranslationItem=Backbone.View.extend({tagName:"label",className:"nl-translation-item",render:function(){this.$el.empty(),this.$input=$('<input type="radio" name="nl_translation_replacement" />'),this.$input.val(this.model.id),this.$el.append(this.$input),this.$el.append(this.model.get("title")),this.$el.data("sort-title",this.model.get("title")),this.$el.data("sort-date",this.model.get("date"));var n=this.model.get("is_assigned");return n&&this.$el.attr("title",nlingualL10n.IsTranslationOf.replace("%s",n)),this}}),d=e.TranslationItemSet=Backbone.View.extend({modelView:r,initialize:function(n){this.children={},this.collection=n.collection||new s,_.bindAll(this,"render","addChild","sortChildren"),this.listenTo(this.collection,"reset",this.render),this.listenTo(this.collection,"add",this.addChild),this.listenTo(this.collection,"sort",this.sortChildren)},get:function(n){return this.children[n]},render:function(){return this.$el.empty(),this.collection.each(this.addChild),this},addChild:function(n){var e=new this.modelView({model:n});return this.children[n.id]=e,this.$el.append(e.render().el),this},sortChildren:function(){var n=this;this.collection.each(function(e){n.get(e.id).$el.appendTo(n.$el)})},remove:function(){_.each(this.children,function(n){n.remove()}),Backbone.View.prototype.remove.apply(this,arguments)}}),c=n.Languages=new a,u=n.LocalizableFields=new i;jQuery(function($){var e,a,l,i;if($("body").on("click",".nl-modal-close, .nl-modal-cancel",function(){$(this).parents(".nl-modal").hide()}),$(".nl-checkall").change(function(){var n=$(this).data("name");$('input[name="'+n+'[]"]').attr("checked",this.checked)}),$(".nl-matchall").change(function(){var n=$(this).data("name");$('[name="'+n+'"]').val(this.checked?"*":"")}),$(".nl-section-content").hide(),$(".nl-section-toggle").each(function(){$(this).data("text",$(this).text())}).click(function(){var n,e,t;n=$(this),e=n.parent(),e.toggleClass("open"),t=e.hasClass("open"),e.find(".nl-section-content").animate({height:"toggle"}),n.text(n.data(t?"alt":"text"))}),$(".nl-preview").on("nl:render",function(){var n,e,t,a,l,i;n=$("#nlingual_default_language").val(),n=c.get(n),n&&(e=n.get("slug")||"en"),t=$("#nlingual_query_var").val()||"nl_language",a=$("#nlingual_skip_default_l10n").attr("checked"),l=$("#nlingual_post_language_override").attr("checked"),i=$(this).hasClass("nl-url-preview")?$(this).data(a?"excluded":"included"):$(this).hasClass("nl-override-preview")?$(this).data(l?"on":"off"):$(this).data("format"),$(this).text(i.replace(/%l/g,e).replace(/%v/g,t))}).trigger("nl:render"),$("#nlingual_default_language").change(function(){$(".nl-preview").trigger("nl:render")}),$("#nlingual_skip_default_l10n").change(function(){$(".nl-preview").trigger("nl:render")}),$("#nlingual_post_language_override").change(function(){$(".nl-preview").trigger("nl:render")}),$("#nlingual_query_var").on("keyup change",function(){$(".nl-preview").trigger("nl:render")}),$(".nl-preview").hide().filter(".nl-redirect-get").show(),$('input[name="nlingual_options[url_rewrite_method]"]').change(function(){var n=$(this).val();this.checked&&n&&$(".nl-preview").hide().filter(".nl-redirect-"+n).show()}).change(),$("#nlingual_languages").each(function(){function e(n){var e,t,a,l;e=s,e=e.replace(/%id%/g,n.id);for(l in n.attributes)a=new RegExp("%"+l+"%","g"),e=e.replace(a,n.get(l));t=$(e),t.find('.nl-language-direction input[value="'+n.get("direction")+'"]').attr("checked",!0),t.find(".nl-language-active input").attr("checked",n.get("active")),i.append(t).sortable("refresh")}var a,l,i,o,s,r,d;a=$(this),l=$("#nl_language_preset"),i=$("#nl_language_list"),o=$("#nl_language_add"),s=$("#nl_language_row").text(),r=-1,i.sortable({items:"tr",containment:"parent",handle:".handle"});for(d in n.presets)l.append('<option value="'+d+'">'+n.presets[d].system_name+"</option>");c.each(e),o.click(function(){var a,i;l.val()?(i=l.val(),a=new t(n.presets[i]),a.set("iso_code",i),l.val(null)):a=new t,a.id=r,a.set("slug",a.get("iso_code")),a.set("active",!0),e(a),r--}),a.on("change",".nl-language-delete input",function(){var n=$(this).parents("tr").first();n.toggleClass("todelete",this.checked),n.find("input").not(this).attr("disabled",this.checked)}),a.on("change",".nl-language-system_name input",function(){var n,e,t,a,l;n=$(this).parents("tr").first(),e=$(this).val(),t=n.find(".nl-language-locale_name input"),a=n.find(".nl-language-iso_code input"),l=n.find(".nl-language-slug input"),a.val()||a.val(e.substr(0,2).toLowerCase()),t.val()||t.val(a.val()),l.val()||l.val(a.val())})}),e=$('<span class="nl-localizer"></span>').html(function(){var n='<span class="nl-localizer-toggle" title="'+nlingualL10n.LocalizeThis+'"></span>';return c.each(function(e){n+='<span class="nl-localizer-option" title="'+nlingualL10n.LocalizeFor.replace("%s",e.get("system_name"))+'" data-nl_language="'+e.id+'"><i class="nl-option-text" data-slug="'+e.get("slug")+'">'+e.get("system_name")+"</i></span>"}),n}),a="nlLocalizerSkipUpdate",u.each(function(t){var a,l,i,o,s,r,d,u;a=t.get("field_id"),l=t.get("values"),i=t.get("nonce"),o=!1,s=$("#"+a),0!==s.length&&s.is("input, textarea")&&(s.addClass("nl-localizable-input"),s.hasClass("wp-editor-area")?r=s.parents(".wp-editor-wrap"):(s.wrap('<span class="nl-localizable"></span>'),r=s.parent()),d=e.clone(),s.data("$nl_localizer",d),d.data("nl_current_language",n.default_language),d.data("$nl_localizer_field",s),u=$('<input type="hidden" />'),u.attr("name",s.attr("name")),u.val(s.val()),u.appendTo(r),d.data("$nl_localized_"+n.default_language,u),c.each(function(e){var t,a;n.default_language!==e.id&&(t=l[e.id]||null,a=$('<input type="hidden" />'),a.attr("name","nlingual_localized["+s.attr("name")+"]["+e.id+"]"),a.val(t),d.data("$nl_localized_"+e.id,a),a.appendTo(r),""!==t&&null!==t&&(o=!0))}),o&&d.find('[data-nl_language="'+n.default_language+'"]').addClass("nl-current"),r.append('<input type="hidden" name="_nl_l10n_nonce['+t.id+']" value="'+i+'" />'),d.appendTo(r))}),$("body").on("click",".nl-localizer-option",function(){var e,t,a,l,i,o,s;e=$(this),t=e.parent(),i=e.data("nl_language"),$(this).addClass("nl-current").siblings().removeClass("nl-current"),i||(i=n.default_language),a=t.data("$nl_localizer_field"),l=t.data("$nl_localized_"+i),a.trigger("nl:localizer:update"),t.data("nl_current_language",i),o=l.val(),s=l.attr("name"),a.val(o).attr("name",s),a.trigger("nl:localizer:change")}),$("body").on("input nl:localizer:update nl:localizer:save",".nl-localizable-input",function(){var n,e,t;n=$(this).data("$nl_localizer"),t=n.data("nl_current_language"),e=n.data("$nl_localized_"+t),e.val(this.value)}),"object"==typeof tinymce){tinymce.on("SetupEditor",function(n){var e=n.editor||n,t=$(e.getElement()),a=t.data("$nl_localizer");a&&(e.on("init",function(){$(e.getContainer()).parent().after(a)}),t.on("nl:localizer:update",function(){var n=e.getContent();n=wp.editor.removep(n),t.val(n)}),t.on("nl:localizer:change",function(){var n=t.val();n=wp.editor.autop(n),e.setContent(n)}))});var o=tinymce.Editor.prototype.save;tinymce.Editor.prototype.save=function(){o.apply(this,arguments),this.fire("SavedContent"),$(this.getElement()).trigger("nl:localizer:save")}}var r=$("#nl_translation_finder"),g=new s,p;r.length>0&&(p=new d({collection:g,el:r.find(".nl-translation-items")}),p.render(),r.on("click",".nl-sort",function(){var n=$(this).data("nl_sort").split(":");g.sortBy(n[0],n[1])})),$(".nl-language-input").change(function(){var n,e;n=$(this).val(),e=$(this).parents(".nl-translations-manager"),e.find(".nl-set-translations").toggleClass("hidden","0"===n),e.find(".nl-translation-field").show(),e.find(".nl-translation-"+n).hide()}).change(),$(".nl-find-translation").click(function(){var n,e,t,a,l,i;n=$(this).parents(".nl-field"),e=n.find(".nl-input"),n.parents(".postbox").length>0?(t=$("#post_ID").val(),a=$("#post_type").val()):(t=n.data("post_id"),a=$(".post_type_page").val()),l=n.data("nl_language"),i=parseInt(e.val(),10),r.one("submit",function(t){t.preventDefault();var a=r.find(".nl-translation-item input:checked"),l=parseInt(a.val());e.val(l),n.toggleClass("nl-is-set",!!l),n.find(".nl-translation-title").text(l?a.parent(".nl-translation-item").text():""),g.reset([]),r.hide()}).show(),$.ajax({url:ajaxurl,data:{action:"nl_find_translations",post_id:t,post_type:a,language_id:l,translation_id:i},dataType:"json",success:function(n){g.reset(n);var e=p.get(i);e&&e.$el.find("input").attr("checked",!0)},error:function(n){alert(n.responseText||nlingualL10n.FindTranslationsError)}})}),$(".nl-add-translation").click(function(){var n,e,t,a,l;n=$(this).parents(".nl-field"),e=n.find(".nl-input"),t=$("#post_ID").val(),a=$("#nl_language").val(),l=e.parents(".nl-field").data("nl_language"),window.open("/wp-admin/admin-post.php?"+$.param({action:"nl_new_translation",post_id:t,post_language_id:a,translation_language_id:l}),"_blank").onload=function(){var t=this.location.href.match(/post=(\d+)/),a=t[1];e.val(a),n.addClass("nl-is-set")}}),$(".nl-edit-translation").click(function(){var n,e,t;if(n=$(this).parents(".nl-field"),"new"===(e=n.find(".nl-input").val())||parseInt(e)<=0)return void alert(nlingualL10n.NoPostSelected);t=$(this).data("url").replace("%d",e),window.open(t)}),"object"==typeof inlineEditPost&&(l=inlineEditPost.edit,inlineEditPost.edit=function(n){var e,t,a,i,o;l.apply(this,arguments),e=0,"object"==typeof n&&(e=parseInt(this.getId(n))),t=$("#post-"+e),a=$("#edit-"+e),i=t.find(".nl-nonce").val(),a.find(".nl-nonce").val(i),o=t.find(".nl-language").val(),a.find(".nl-language-input").val(o).change(),a.find(".nl-translation-field").each(function(){var n,a,l;$(this).data("post_id",e),n=$(this).data("nl_language"),a=t.find(".nl-translation-"+n).val(),l=t.find(".nl-translation-"+n+"-title").val(),$(this).toggleClass("nl-is-set",a).find(".nl-input").val(a||0),$(this).find(".nl-translation-title").text(l)})}),"object"==typeof inlineEditTax&&(i=inlineEditTax.edit,inlineEditTax.edit=function(){i.apply(this,arguments)})})}();
//# sourceMappingURL=./admin.min.js.map