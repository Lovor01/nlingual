!function(){var g=window.nLingual={},n=g.Framework={},h=n.Language=Backbone.Model.extend({defaults:{system_name:"",native_name:"",short_name:"",iso_code:"",slug:"",locale_name:"",direction:"",active:!0}}),e=n.LanguageSet=Backbone.Collection.extend({model:h}),t=n.LocalizableField=Backbone.Model.extend({idAttribute:"field",defaults:{field_id:"",values:"",nonce:""}}),a=n.LocalizableFieldSet=Backbone.Collection.extend({model:t}),l=n.Translation=Backbone.Model.extend({defaults:{title:"",date:"",is_assigned:!1}}),i=n.TranslationSet=Backbone.Collection.extend({model:l,sortBy:function(l,i){i=!0===i||"desc"===i,this.models=this.models.sort(function(n,e){var t=n.get(l),a=e.get(l);return a<t?i?-1:1:t<a?i?1:-1:0}),this.trigger("sort",this)}}),o=n.TranslationItem=Backbone.View.extend({tagName:"label",className:"nl-translation-item",render:function(){this.$el.empty(),this.$input=$('<input type="radio" name="nl_translation_replacement" />'),this.$input.val(this.model.id),this.$el.append(this.$input),this.$el.append(this.model.get("title")),this.$el.data("sort-title",this.model.get("title")),this.$el.data("sort-date",this.model.get("date"));var n=this.model.get("is_assigned");return n&&this.$el.attr("title",nlingualL10n.IsTranslationOf.replace("%s",n)),this}}),p=n.TranslationItemSet=Backbone.View.extend({modelView:o,initialize:function(n){this.children={},this.collection=n.collection||new i,_.bindAll(this,"render","addChild","sortChildren"),this.listenTo(this.collection,"reset",this.render),this.listenTo(this.collection,"add",this.addChild),this.listenTo(this.collection,"sort",this.sortChildren)},get:function(n){return this.children[n]},render:function(){return this.$el.empty(),this.collection.each(this.addChild),this},addChild:function(n){var e=new this.modelView({model:n});return this.children[n.id]=e,this.$el.append(e.render().el),this},sortChildren:function(){var e=this;this.collection.each(function(n){e.get(n.id).$el.appendTo(e.$el)})},remove:function(){_.each(this.children,function(n){n.remove()}),Backbone.View.prototype.remove.apply(this,arguments)}}),v=g.Languages=new e,f=g.LocalizableFields=new a;jQuery(function(d){var c,n,o,e;if(d("body").on("click",".nl-modal-close, .nl-modal-cancel",function(){d(this).parents(".nl-modal").hide()}),d(".nl-checkall").change(function(){var n=d(this).data("name");d('input[name="'+n+'[]"]').attr("checked",this.checked)}),d(".nl-matchall").change(function(){var n=d(this).data("name");d('[name="'+n+'"]').val(this.checked?"*":"")}),d(".nl-section-content").hide(),d(".nl-section-toggle").each(function(){d(this).data("text",d(this).text())}).click(function(){var n,e,t;(e=(n=d(this)).parent()).toggleClass("open"),t=e.hasClass("open"),e.find(".nl-section-content").animate({height:"toggle"}),n.text(n.data(t?"alt":"text"))}),d(".nl-preview").on("nl:render",function(){var n,e,t,a,l,i;n=d("#nlingual_default_language").val(),(n=v.get(n))&&(e=n.get("slug")||"en"),t=d("#nlingual_query_var").val()||"nl_language",a=d("#nlingual_skip_default_l10n").attr("checked"),l=d("#nlingual_post_language_override").attr("checked"),i=d(this).hasClass("nl-url-preview")?d(this).data(a?"excluded":"included"):d(this).hasClass("nl-override-preview")?d(this).data(l?"on":"off"):d(this).data("format"),d(this).text(i.replace(/%l/g,e).replace(/%v/g,t))}).trigger("nl:render"),d("#nlingual_default_language").change(function(){d(".nl-preview").trigger("nl:render")}),d("#nlingual_skip_default_l10n").change(function(){d(".nl-preview").trigger("nl:render")}),d("#nlingual_post_language_override").change(function(){d(".nl-preview").trigger("nl:render")}),d("#nlingual_query_var").on("keyup change",function(){d(".nl-preview").trigger("nl:render")}),d(".nl-preview").hide().filter(".nl-redirect-get").show(),d('input[name="nlingual_options[url_rewrite_method]"]').change(function(){var n=d(this).val();this.checked&&n&&d(".nl-preview").hide().filter(".nl-redirect-"+n).show()}).change(),d("#nlingual_languages").each(function(){function t(n){var e,t,a,l;for(l in e=(e=o).replace(/%id%/g,n.id),n.attributes)a=new RegExp("%"+l+"%","g"),e=e.replace(a,n.get(l));(t=d(e)).find('.nl-language-direction input[value="'+n.get("direction")+'"]').attr("checked",!0),t.find(".nl-language-active input").attr("checked",n.get("active")),i.append(t).sortable("refresh")}var n,a,i,e,o,l,s;for(s in n=d(this),a=d("#nl_language_preset"),i=d("#nl_language_list"),e=d("#nl_language_add"),o=d("#nl_language_row").text(),l=-1,i.sortable({items:"tr",containment:"parent",handle:".handle"}),g.presets)a.append('<option value="'+s+'">'+g.presets[s].system_name+"</option>");v.each(t),e.click(function(){var n,e;a.val()?(e=a.val(),(n=new h(g.presets[e])).set("iso_code",e),a.val(null)):n=new h,n.id=l,n.set("slug",n.get("iso_code")),n.set("active",!0),t(n),l--}),n.on("change",".nl-language-delete input",function(){var n=d(this).parents("tr").first();n.toggleClass("todelete",this.checked),n.find("input").not(this).attr("disabled",this.checked)}),n.on("change",".nl-language-system_name input",function(){var n,e,t,a,l;n=d(this).parents("tr").first(),e=d(this).val(),t=n.find(".nl-language-locale_name input"),a=n.find(".nl-language-iso_code input"),l=n.find(".nl-language-slug input"),a.val()||a.val(e.substr(0,2).toLowerCase()),t.val()||t.val(a.val()),l.val()||l.val(a.val())})}),c=d('<div class="nl-localizer"></div>').html(function(){var e='<div class="nl-localizer-toggle" title="'+nlingualL10n.LocalizeThis+'"></div>';return v.each(function(n){e+='<div class="nl-localizer-option" title="'+nlingualL10n.LocalizeFor.replace("%s",n.get("system_name"))+'" data-nl_language="'+n.id+'"><div class="nl-option-text" data-slug="'+n.get("slug")+'">'+n.get("system_name")+"</div></div>"}),e}),n="nlLocalizerSkipUpdate",f.each(function(n){var e,a,t,l,i,o,s,r;e=n.get("field_id"),a=n.get("values"),t=n.get("nonce"),l=!1,0!==(i=d("#"+e)).length&&i.is("input, textarea")&&(i.addClass("nl-localizable-input"),o=i.hasClass("wp-editor-area")?i.parents(".wp-editor-wrap"):(i.wrap('<div class="nl-localizable"></div>'),i.parent()),s=c.clone(),i.data("$nl_localizer",s),s.data("nl_current_language",g.default_language),s.data("$nl_localizer_field",i),(r=d('<input type="hidden" />')).attr("name",i.attr("name")),r.val(i.val()),r.appendTo(o),s.data("$nl_localized_"+g.default_language,r),v.each(function(n){var e,t;g.default_language!==n.id&&(e=a[n.id]||null,(t=d('<input type="hidden" />')).attr("name","nlingual_localized["+i.attr("name")+"]["+n.id+"]"),t.val(e),s.data("$nl_localized_"+n.id,t),t.appendTo(o),""!==e&&null!==e&&(l=!0))}),l&&s.find('[data-nl_language="'+g.default_language+'"]').addClass("nl-current"),o.append('<input type="hidden" name="_nl_l10n_nonce['+n.id+']" value="'+t+'" />'),s.appendTo(o))}),d("body").on("click",".nl-localizer-option",function(){var n,e,t,a,l,i,o;e=(n=d(this)).parent(),l=n.data("nl_language"),d(this).addClass("nl-current").siblings().removeClass("nl-current"),l||(l=g.default_language),t=e.data("$nl_localizer_field"),a=e.data("$nl_localized_"+l),t.trigger("nl:localizer:update"),e.data("nl_current_language",l),i=a.val(),o=a.attr("name"),t.val(i).attr("name",o),t.trigger("nl:localizer:change")}),d("body").on("input nl:localizer:update nl:localizer:save",".nl-localizable-input",function(){var n,e,t;t=(n=d(this).data("$nl_localizer")).data("nl_current_language"),(e=n.data("$nl_localized_"+t)).val(this.value)}),"object"==typeof tinymce){tinymce.on("SetupEditor",function(n){var e=n.editor||n,t=d(e.getElement()),a=t.data("$nl_localizer");a&&(e.on("init",function(){d(e.getContainer()).parent().after(a)}),t.on("nl:localizer:update",function(){var n=e.getContent();n=wp.editor.removep(n),t.val(n)}),t.on("nl:localizer:change",function(){var n=t.val();n=wp.editor.autop(n),e.setContent(n)}))});var t=tinymce.Editor.prototype.save;tinymce.Editor.prototype.save=function(){t.apply(this,arguments),this.fire("SavedContent"),d(this.getElement()).trigger("nl:localizer:save")}}var s=d("#nl_translation_finder"),r=new i,u;0<s.length&&((u=new p({collection:r,el:s.find(".nl-translation-items")})).render(),s.on("click",".nl-sort",function(){var n=d(this).data("nl_sort").split(":");r.sortBy(n[0],n[1])})),d(".nl-language-input").change(function(){var n,e;n=d(this).val(),(e=d(this).parents(".nl-translations-manager")).find(".nl-set-translations").toggleClass("hidden","0"===n),e.find(".nl-translation-field").show(),e.find(".nl-translation-"+n).hide()}).change(),d(".nl-find-translation").click(function(){var a,l,n,e,t,i;a=d(this).parents(".nl-field"),l=a.find(".nl-input"),e=0<a.parents(".postbox").length?(n=d("#post_ID").val(),d("#post_type").val()):(n=a.data("post_id"),d(".post_type_page").val()),t=a.data("nl_language"),i=parseInt(l.val(),10),s.one("submit",function(n){n.preventDefault();var e=s.find(".nl-translation-item input:checked"),t=parseInt(e.val());l.val(t),a.toggleClass("nl-is-set",!!t),a.find(".nl-translation-title").text(t?e.parent(".nl-translation-item").text():""),r.reset([]),s.hide()}).show(),d.ajax({url:ajaxurl,data:{action:"nl_find_translations",post_id:n,post_type:e,language_id:t,translation_id:i},dataType:"json",success:function(n){r.reset(n);var e=u.get(i);e&&e.$el.find("input").attr("checked",!0)},error:function(n){alert(n.responseText||nlingualL10n.FindTranslationsError)}})}),d(".nl-add-translation").click(function(){var t,a,n,e,l,i;t=d(this).parents(".nl-field"),a=t.find(".nl-input"),n=d("#post_ID").val(),e=d("#nl_language").val(),l=a.parents(".nl-field").data("nl_language"),window.open("/wp-admin/admin-post.php?"+d.param({action:"nl_new_translation",post_id:n,post_language_id:e,translation_language_id:l}),"_blank").onload=function(){var n,e=this.location.href.match(/post=(\d+)/)[1];a.val(e),t.addClass("nl-is-set")}}),d(".nl-edit-translation").click(function(){var n,e,t;"new"===(e=(n=d(this).parents(".nl-field")).find(".nl-input").val())||parseInt(e)<=0?alert(nlingualL10n.NoPostSelected):(t=d(this).data("url").replace("%d",e),window.open(t))}),"object"==typeof inlineEditPost&&(o=inlineEditPost.edit,inlineEditPost.edit=function(n){var a,l,e,t,i;o.apply(this,arguments),a=0,"object"==typeof n&&(a=parseInt(this.getId(n))),l=d("#post-"+a),e=d("#edit-"+a),t=l.find(".nl-nonce").val(),e.find(".nl-nonce").val(t),i=l.find(".nl-language").val(),e.find(".nl-language-input").val(i).change(),e.find(".nl-translation-field").each(function(){var n,e,t;d(this).data("post_id",a),n=d(this).data("nl_language"),e=l.find(".nl-translation-"+n).val(),t=l.find(".nl-translation-"+n+"-title").val(),d(this).toggleClass("nl-is-set",e).find(".nl-input").val(e||0),d(this).find(".nl-translation-title").text(t)})}),"object"==typeof inlineEditTax&&(e=inlineEditTax.edit,inlineEditTax.edit=function(){e.apply(this,arguments)})})}();
//# sourceMappingURL=admin.min.js.map