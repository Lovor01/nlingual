(()=>{const n=window.nLingual={},e=n.Framework={},t=e.Language=Backbone.Model.extend({defaults:{system_name:"",native_name:"",short_name:"",iso_code:"",slug:"",locale_name:"",direction:"",active:!0}}),a=e.LanguageSet=Backbone.Collection.extend({model:t}),l=e.LocalizableField=Backbone.Model.extend({idAttribute:"field",defaults:{field_id:"",values:"",nonce:""}}),i=e.LocalizableFieldSet=Backbone.Collection.extend({model:l}),o=n.Languages=new a,s=n.LocalizableFields=new i;jQuery((e=>{e(".nl-checkall").change((function(){const n=e(this).data("name");e(`input[name="${n}[]"]`).attr("checked",this.checked)})),e(".nl-matchall").change((function(){const n=e(this).data("name");e(`[name="${n}"]`).val(this.checked?"*":"")})),e(".nl-section-content").hide(),e(".nl-section-toggle").each((function(){e(this).data("text",e(this).text())})).click((function(){const n=e(this),t=n.parent();t.toggleClass("open");const a=t.hasClass("open");t.find(".nl-section-content").animate({height:"toggle"}),n.text(n.data(a?"alt":"text"))})),e(".nl-preview").on("nl:render",(function(){const n=o.get(e("#nlingual_default_language").val()),t=n&&n.get("slug")||"en",a=e("#nlingual_query_var").val()||"nl_language",l=e("#nlingual_skip_default_l10n").is(":checked"),i=e("#nlingual_post_language_override").is(":checked");let s;s=e(this).hasClass("nl-url-preview")?e(this).data(l?"excluded":"included"):e(this).hasClass("nl-override-preview")?e(this).data(i?"on":"off"):e(this).data("format"),e(this).text(s.replace(/%l/g,t).replace(/%v/g,a))})).trigger("nl:render"),e("#nlingual_default_language").change((function(){e(".nl-preview").trigger("nl:render")})),e("#nlingual_skip_default_l10n").change((function(){e(".nl-preview").trigger("nl:render")})),e("#nlingual_post_language_override").change((function(){e(".nl-preview").trigger("nl:render")})),e("#nlingual_query_var").on("keyup change",(function(){e(".nl-preview").trigger("nl:render")})),e(".nl-preview").hide().filter(".nl-redirect-get").show(),e('input[name="nlingual_options[url_rewrite_method]"]').change((function(){const n=e(this).val();this.checked&&n&&e(".nl-preview").hide().filter(`.nl-redirect-${n}`).show()})).change(),e("#nlingual_languages").each((function(){const a=e(this),l=e("#nl_language_preset"),i=e("#nl_language_list"),s=e("#nl_language_add"),c=e("#nl_language_row").text();let d=-1;i.sortable({items:"tr",containment:"parent",handle:".handle"});for(const e in n.presets)l.append(`<option value="${e}">${n.presets[e].system_name}</option>`);function r(n){let t=c.replace(/%id%/g,n.id);for(const e in n.attributes){const a=new RegExp("%"+e+"%","g");t=t.replace(a,n.get(e))}const a=e(t);a.find(`.nl-language-direction input[value="${n.get("direction")}"]`).attr("checked",!0),a.find(".nl-language-active input").attr("checked",n.get("active")),i.append(a).sortable("refresh")}o.each(r),s.click((function(){let e;if(l.val()){const a=l.val();e=new t(n.presets[a]),e.set("iso_code",a),l.val(null)}else e=new t;e.id=d,e.set("slug",e.get("iso_code")),e.set("active",!0),r(e),d--})),a.on("change",".nl-language-delete input",(function(){const n=e(this).parents("tr").first();n.toggleClass("todelete",this.checked),n.find("input").not(this).attr("disabled",this.checked)})),a.on("change",".nl-language-system_name input",(function(){const n=e(this).parents("tr").first(),t=e(this).val(),a=n.find(".nl-language-locale_name input"),l=n.find(".nl-language-iso_code input"),i=n.find(".nl-language-slug input");l.val()||l.val(t.substr(0,2).toLowerCase()),a.val()||a.val(l.val()),i.val()||i.val(l.val())}))}));const a=e('<div class="nl-localizer"></div>').html((function(){let n=`<div class="nl-localizer-toggle" title="${nlingualL10n.LocalizeThis}"></div>`;return o.each((e=>{const t=nlingualL10n.LocalizeFor.replace("%s",e.get("system_name"));n+=`<div class="nl-localizer-option" title="${t}" data-nl_language="${e.id}">\n\t\t\t\t\t<div class="nl-option-text" data-slug="${e.get("slug")}">${e.get("system_name")}</div>\n\t\t\t\t</div>`})),n}));s.each((t=>{const l=t.get("field_id"),i=e("#"+l);if(0===i.length||!i.is("input, textarea"))return;const s=t.get("values"),c=t.get("nonce");let d;i.addClass("nl-localizable-input"),i.hasClass("wp-editor-area")?d=i.parents(".wp-editor-wrap"):(i.wrap('<div class="nl-localizable"></div>'),d=i.parent());const r=a.clone();i.data("$nl_localizer",r),r.data("nl_current_language",n.default_language),r.data("$nl_localizer_field",i);const g=e('<input type="hidden" />');g.attr("name",i.attr("name")),g.val(i.val()),g.appendTo(d),r.data(`$nl_localized_${n.default_language}`,g);let u=!1;o.each((t=>{if(n.default_language===t.id)return;const a=s[t.id]||null,l=e('<input type="hidden" />');l.attr("name",`nlingual_localized[${i.attr("name")}][${t.id}]`),l.val(a),r.data(`$nl_localized_${t.id}`,l),l.appendTo(d),""!==a&&null!==a&&(u=!0)})),u&&r.find(`[data-nl_language="${n.default_language}"]`).addClass("nl-current"),d.append(`<input type="hidden" name="_nl_l10n_nonce[${t.id}]" value="${c}" />`),r.appendTo(d)})),e("body").on("click",".nl-localizer-option",(function(){const t=e(this),a=t.parent(),l=t.data("nl_language")||n.default_language;e(this).addClass("nl-current").siblings().removeClass("nl-current");const i=a.data("$nl_localizer_field"),o=a.data(`$nl_localized_${l}`);i.trigger("nl:localizer:update"),a.data("nl_current_language",l);const s=o.val(),c=o.attr("name");i.val(s).attr("name",c),i.trigger("nl:localizer:change")})),e("body").on("input nl:localizer:update nl:localizer:save",".nl-localizable-input",(function(){const n=e(this).data("$nl_localizer"),t=n.data("nl_current_language");n.data(`$nl_localized_${t}`).val(this.value)}));const l=wp.oldEditor||wp.editor;if("object"==typeof tinymce){function i(n){var t=e(n.getElement()),a=t.data("$nl_localizer");a&&(n.on("init",(()=>{e(n.getContainer()).parent().after(a)})),t.on("nl:localizer:update",(()=>{const e=l.removep(n.getContent());t.val(e)})),t.on("nl:localizer:change",(()=>{const e=l.autop(t.val());n.setContent(e)})))}tinymce.editors.forEach(i),tinymce.on("SetupEditor",(n=>{i(n.editor||n)}));const n=tinymce.Editor.prototype.save;tinymce.Editor.prototype.save=function(){n.apply(this,arguments),this.fire("SavedContent"),e(this.getElement()).trigger("nl:localizer:save")}}if(e(".nl-language-input").change((function(){const n=e(this).val(),t=e(this).parents(".nl-translation-manager");t.find(".nl-manage-translations").toggleClass("hidden","0"===n),t.find(".nl-translation-field").show(),t.find(".nl-translation-"+n).hide()})).change(),e(".nl-add-translation").click((function(){const n=e(this).parents(".nl-field"),t=n.find(".nl-input"),a=n.find(".nl-translation-select"),l=e("#post_ID").val(),i=e("#nl_language").val(),o=t.parents(".nl-field").data("nl_language");window.open(nlingualL10n.admin_post+"?"+e.param({action:"nl_new_translation",post_id:l,post_language_id:i,translation_language_id:o}),"_blank").onload=function(){const[,e]=this.location.href.match(/post=(\d+)/);t.val(e),n.addClass("nl-has-translation"),a.attr("name",null)}})),e(".nl-find-translation").click((function(){const n=e(this).parents(".nl-field"),t=n.find(".nl-translation-input"),a=n.find(".nl-translation-select");a.attr("name",t.attr("name")),a.show()})),e(".nl-edit-translation").click((function(){const n=e(this).parents(".nl-field").find(".nl-input").val();if("new"===n||parseInt(n,10)<=0)return void alert(nlingualL10n.NoPostSelected);const t=e(this).data("url").replace("%d",n);window.open(t)})),e(".nl-drop-translation").click((function(){if(!confirm(nlingualL10n.RemoveTranslationConfirm))return;const n=e(this).parents(".nl-field"),t=n.find(".nl-translation-input"),a=n.find(".nl-translation-title"),l=e("#post_ID").val(),i=t.parents(".nl-field").data("nl_language");e.ajax({url:ajaxurl,type:"POST",data:{action:"nl_drop_translation",post_id:l,language_id:i},success(){t.val(null),a.text(nlingualL10n.NoTranslation),n.removeClass("nl-has-translation")},error(){alert(nlingualL10n.RemoveTranslationError)}})})),"object"==typeof inlineEditPost){const n=inlineEditPost.edit;inlineEditPost.edit=function(t){n.apply(this,arguments);const a=t&&parseInt(this.getId(t),10)||0,l=e(`#post-${a}`),i=e(`#edit-${a}`),o=l.find(".nl-nonce").val();i.find(".nl-nonce").val(o);const s=l.find(".nl-language").val();i.find(".nl-language-input").val(s).change(),i.find(".nl-translation-field").each((function(){const n=e(this).data("nl_language"),t=l.find(`.nl-translation-${n}`).val();e(this).find("select").val(t||0)}))}}}))})();
//# sourceMappingURL=admin.min.js.map